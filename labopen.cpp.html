<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html
     PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
    <head>
<title>C:\Documents and Settings\Owner\Desktop\hcfa\labopen\labopen.cpp</title>
<style type="text/css">
body.default {
    font-family: Courier New;
    color: #ffffff;
    background-color: #000000;
    font-size: 15.0px;
    font-weight: normal;
    font-style: normal;
}
span.commentdockeyworderror {
    color: #ffff22;
}
span.bracebad {
    color: #379b9b;
    font-weight: bold;
}
span.stdin {
}
span.verbatim {
    color: #000000;
}
span.stdout {
}
span.operators {
    color: #3366ff;
}
span.keywords2 {
    color: #78e087;
}
span.linenumbers {
    color: #777777;
}
span.UUIDs {
    color: #000000;
}
span.keywords {
    color: #00ff00;
}
span.commentdockeyword {
    color: #000000;
}
span.regex {
    color: #379bff;
}
span.preprocessor {
    color: #adadad;
}
span.stringeol {
}
span.default {
}
span.identifiers {
}
span.indent_guides {
    color: #333333;
}
span.comments {
    color: #ff00ff;
    font-style: italic;
}
span.globalclass {
    color: #ff7474;
}
span.bracehighlight {
    color: #379b9b;
    font-weight: bold;
}
span.stderr {
    color: #99ffff;
    font-style: italic;
}
span.strings {
    color: #dcdc71;
}
span.control_characters {
    color: #000000;
}
span.numbers {
    color: #74ffff;
}

</style>
</head>
<body class="default"><p>
<br /><span class="linenumbers">&nbsp;&nbsp;&nbsp;1&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="comments">//&nbsp;labopen.cpp&nbsp;:&nbsp;Defines&nbsp;the&nbsp;entry&nbsp;point&nbsp;for&nbsp;the&nbsp;console&nbsp;application.
</span><br /><span class="linenumbers">&nbsp;&nbsp;&nbsp;2&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="comments">//
</span><br /><span class="linenumbers">&nbsp;&nbsp;&nbsp;3&nbsp;&nbsp;&nbsp;&nbsp;</span>
<br /><span class="linenumbers">&nbsp;&nbsp;&nbsp;4&nbsp;&nbsp;&nbsp;&nbsp;</span>
<br /><span class="linenumbers">&nbsp;&nbsp;&nbsp;5&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="preprocessor">#include&nbsp;"tchar.h"
</span><br /><span class="linenumbers">&nbsp;&nbsp;&nbsp;6&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="preprocessor">#include&nbsp;"Windows.h"
</span><br /><span class="linenumbers">&nbsp;&nbsp;&nbsp;7&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="preprocessor">#include&nbsp;"strsafe.h"
</span><br /><span class="linenumbers">&nbsp;&nbsp;&nbsp;8&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="preprocessor">#include&nbsp;&lt;malloc.h&gt;
</span><br /><span class="linenumbers">&nbsp;&nbsp;&nbsp;9&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="preprocessor">#include&nbsp;"shlwapi.h"
</span><br /><span class="linenumbers">&nbsp;&nbsp;10&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="preprocessor">#pragma&nbsp;intrinsic(memcpy)
</span><br /><span class="linenumbers">&nbsp;&nbsp;11&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="preprocessor">#define&nbsp;ORIGPATH&nbsp;"href=\"../MASTERS/StdAlneEZclaim&nbsp;modified&nbsp;for&nbsp;Office.pdf\""
</span><br /><span class="linenumbers">&nbsp;&nbsp;12&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="preprocessor">#define&nbsp;NEWPATH&nbsp;"href=\"/C/Documents&nbsp;and&nbsp;Settings/Administrator/My&nbsp;Documents/Medical/Medicare&nbsp;Med</span><br /><span class="linenumbers">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="preprocessor">icaid/MASTERS/"
</span><br /><span class="linenumbers">&nbsp;&nbsp;13&nbsp;&nbsp;&nbsp;&nbsp;</span>
<br /><span class="linenumbers">&nbsp;&nbsp;14&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="preprocessor">#ifdef&nbsp;_UNICODE
</span><br /><span class="linenumbers">&nbsp;&nbsp;15&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="preprocessor">#&nbsp;&nbsp;define&nbsp;InplaceCrudeTSTRToAscii(x)&nbsp;InplaceCrudeWSTRToAscii(x)
</span><br /><span class="linenumbers">&nbsp;&nbsp;16&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="preprocessor">#&nbsp;&nbsp;define&nbsp;InplaceCrudeWSTRToTSTR(x)&nbsp;(x)
</span><br /><span class="linenumbers">&nbsp;&nbsp;17&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="preprocessor">#else
</span><br /><span class="linenumbers">&nbsp;&nbsp;18&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="preprocessor">#&nbsp;&nbsp;define&nbsp;InplaceCrudeTSTRToAscii(x)&nbsp;(x)
</span><br /><span class="linenumbers">&nbsp;&nbsp;19&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="preprocessor">#&nbsp;&nbsp;define&nbsp;InplaceCrudeWSTRToTSTR(x)&nbsp;InplaceCrudeWSTRToAscii(x)
</span><br /><span class="linenumbers">&nbsp;&nbsp;20&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="preprocessor">#endif
</span><br /><span class="linenumbers">&nbsp;&nbsp;21&nbsp;&nbsp;&nbsp;&nbsp;</span>
<br /><span class="linenumbers">&nbsp;&nbsp;22&nbsp;&nbsp;&nbsp;&nbsp;</span>
<br /><span class="linenumbers">&nbsp;&nbsp;23&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="keywords">void</span><span class="default">&nbsp;</span><span class="identifiers">DisplayError</span><span class="operators">(</span><span class="identifiers">LPTSTR</span><span class="default">&nbsp;</span><span class="identifiers">lpszFunction</span><span class="operators">);</span>
<br /><span class="linenumbers">&nbsp;&nbsp;24&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="keywords">char</span><span class="default">&nbsp;</span><span class="operators">*</span><span class="default">&nbsp;</span><span class="identifiers">InplaceCrudeWSTRToAscii</span><span class="operators">(</span><span class="identifiers">LPWSTR</span><span class="default">&nbsp;</span><span class="identifiers">wstr</span><span class="operators">);</span>
<br /><span class="linenumbers">&nbsp;&nbsp;25&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="keywords">void</span><span class="default">&nbsp;</span><span class="identifiers">WINAPI</span><span class="default">&nbsp;</span><span class="identifiers">LazyMessageBox</span><span class="operators">(</span><span class="identifiers">LPCTSTR</span><span class="default">&nbsp;</span><span class="identifiers">str</span><span class="operators">);</span>
<br /><span class="linenumbers">&nbsp;&nbsp;26&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="identifiers">LPTSTR</span><span class="default">&nbsp;</span><span class="identifiers">GetFormattedMessage</span><span class="operators">(</span><span class="identifiers">LPCTSTR</span><span class="default">&nbsp;</span><span class="identifiers">pMessage</span><span class="operators">,</span><span class="default">&nbsp;</span><span class="operators">...);</span>
<br /><span class="linenumbers">&nbsp;&nbsp;27&nbsp;&nbsp;&nbsp;&nbsp;</span>
<br /><span class="linenumbers">&nbsp;&nbsp;28&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="keywords">int</span><span class="default">&nbsp;</span><span class="identifiers">WinMainNoCRT</span><span class="operators">(</span><span class="keywords">void</span><span class="operators">)</span><span class="default">&nbsp;</span><span class="operators">{</span>
<br /><span class="linenumbers">&nbsp;&nbsp;29&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="default">&nbsp;&nbsp;&nbsp;</span><span class="identifiers">LPWSTR</span><span class="default">&nbsp;</span><span class="operators">*</span><span class="identifiers">argv</span><span class="operators">;</span>
<br /><span class="linenumbers">&nbsp;&nbsp;30&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="default">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="keywords">int</span><span class="default">&nbsp;</span><span class="identifiers">argc</span><span class="operators">;</span>
<br /><span class="linenumbers">&nbsp;&nbsp;31&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="default">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="identifiers">argv</span><span class="default">&nbsp;</span><span class="operators">=</span><span class="default">&nbsp;</span><span class="identifiers">CommandLineToArgvW</span><span class="operators">(</span><span class="identifiers">GetCommandLineW</span><span class="operators">(),</span><span class="default">&nbsp;</span><span class="operators">&amp;</span><span class="identifiers">argc</span><span class="operators">);</span>
<br /><span class="linenumbers">&nbsp;&nbsp;32&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="default">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="identifiers">size_t</span><span class="default">&nbsp;</span><span class="identifiers">argvlen4</span><span class="operators">;</span>
<br /><span class="linenumbers">&nbsp;&nbsp;33&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="default">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="keywords">if</span><span class="operators">(</span><span class="identifiers">argc</span><span class="default">&nbsp;</span><span class="operators">!=</span><span class="default">&nbsp;</span><span class="numbers">5</span><span class="default">&nbsp;</span><span class="operators">||</span><span class="default">&nbsp;</span><span class="operators">(</span><span class="identifiers">argvlen4</span><span class="default">&nbsp;</span><span class="operators">=</span><span class="default">&nbsp;</span><span class="identifiers">lstrlenA</span><span class="operators">(</span><span class="identifiers">InplaceCrudeWSTRToAscii</span><span class="operators">(</span><span class="identifiers">argv</span><span class="operators">[</span><span class="numbers">4</span><span class="operators">])))</span><span class="default">&nbsp;</span><span class="operators">!=</span><span class="default">&nbsp;</span><span class="numbers">32</span><span class="operators">)</span><span class="default">&nbsp;</span><span class="operators">{</span>
<br /><span class="linenumbers">&nbsp;&nbsp;34&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="default">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="identifiers">LazyMessageBox</span><span class="operators">(</span><span class="identifiers">_T</span><span class="operators">(</span><span class="strings">"usage:&nbsp;labopen.exe&nbsp;\"src&nbsp;xfdf&nbsp;path\"&nbsp;\"plain&nbsp;english&nbsp;lab&nbsp;name\"&nbsp;\"lab&nbsp;pdf&nbsp;pat</span><br /><span class="linenumbers">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="strings">h\"&nbsp;\"32&nbsp;char&nbsp;lab&nbsp;'original'&nbsp;property&nbsp;XML&nbsp;hex&nbsp;sha1\""</span><span class="operators">));</span>
<br /><span class="linenumbers">&nbsp;&nbsp;35&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="default">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="keywords">return</span><span class="default">&nbsp;</span><span class="numbers">0</span><span class="operators">;</span>
<br /><span class="linenumbers">&nbsp;&nbsp;36&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="default">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="operators">}</span>
<br /><span class="linenumbers">&nbsp;&nbsp;37&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="default">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="identifiers">HANDLE</span><span class="default">&nbsp;</span><span class="identifiers">hFile</span><span class="operators">,</span><span class="default">&nbsp;</span><span class="identifiers">hMap</span><span class="operators">;</span>
<br /><span class="linenumbers">&nbsp;&nbsp;38&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="default">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="identifiers">DWORD</span><span class="default">&nbsp;</span><span class="identifiers">filesize</span><span class="operators">;</span>
<br /><span class="linenumbers">&nbsp;&nbsp;39&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="default">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="keywords">char</span><span class="default">&nbsp;</span><span class="operators">*</span><span class="identifiers">p</span><span class="operators">;</span>
<br /><span class="linenumbers">&nbsp;&nbsp;40&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="default">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="keywords">char</span><span class="default">&nbsp;</span><span class="operators">*</span><span class="identifiers">newfile</span><span class="operators">;</span>
<br /><span class="linenumbers">&nbsp;&nbsp;41&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="default">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="keywords">char</span><span class="default">&nbsp;</span><span class="operators">*</span><span class="identifiers">newfilecursor</span><span class="operators">;</span>
<br /><span class="linenumbers">&nbsp;&nbsp;42&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="default">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="keywords">char</span><span class="default">&nbsp;</span><span class="operators">*</span><span class="identifiers">newfilecursor2</span><span class="operators">;</span>
<br /><span class="linenumbers">&nbsp;&nbsp;43&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="default">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="identifiers">DWORD</span><span class="default">&nbsp;</span><span class="identifiers">dwBytesWritten</span><span class="operators">;</span>
<br /><span class="linenumbers">&nbsp;&nbsp;44&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="default">&nbsp;
</span><br /><span class="linenumbers">&nbsp;&nbsp;45&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="default">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="identifiers">hFile</span><span class="default">&nbsp;</span><span class="operators">=</span><span class="default">&nbsp;</span><span class="identifiers">CreateFile</span><span class="operators">(</span><span class="identifiers">InplaceCrudeWSTRToTSTR</span><span class="operators">(</span><span class="identifiers">argv</span><span class="operators">[</span><span class="numbers">1</span><span class="operators">]),</span><span class="default">&nbsp;</span><span class="identifiers">GENERIC_READ</span><span class="operators">,</span><span class="default">&nbsp;</span><span class="numbers">0</span><span class="operators">,</span><span class="default">&nbsp;</span><span class="identifiers">NULL</span><span class="operators">,</span><span class="default">&nbsp;</span><span class="identifiers">OPEN_EXISTING</span><span class="operators">,</span><span class="default">&nbsp;</span><span class="identifiers">FIL</span><br /><span class="linenumbers">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="identifiers">E_ATTRIBUTE_NORMAL</span><span class="operators">,</span><span class="default">&nbsp;</span><span class="identifiers">NULL</span><span class="operators">);</span>
<br /><span class="linenumbers">&nbsp;&nbsp;46&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="default">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="keywords">if</span><span class="default">&nbsp;</span><span class="operators">(</span><span class="identifiers">hFile</span><span class="default">&nbsp;</span><span class="operators">==</span><span class="default">&nbsp;</span><span class="identifiers">INVALID_HANDLE_VALUE</span><span class="operators">)</span><span class="default">&nbsp;
</span><br /><span class="linenumbers">&nbsp;&nbsp;47&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="default">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="operators">{</span><span class="default">&nbsp;
</span><br /><span class="linenumbers">&nbsp;&nbsp;48&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="default">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="identifiers">DisplayError</span><span class="operators">(</span><span class="identifiers">TEXT</span><span class="operators">(</span><span class="strings">"CreateFile"</span><span class="operators">));</span>
<br /><span class="linenumbers">&nbsp;&nbsp;49&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="default">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="identifiers">LPWSTR</span><span class="default">&nbsp;</span><span class="identifiers">msg</span><span class="default">&nbsp;</span><span class="operators">=</span><span class="default">&nbsp;</span><span class="identifiers">GetFormattedMessage</span><span class="operators">(</span><span class="identifiers">TEXT</span><span class="operators">(</span><span class="strings">"Terminal&nbsp;failure:&nbsp;unable&nbsp;to&nbsp;open&nbsp;file&nbsp;\"%1!s!\"&nbsp;for&nbsp;read.</span><br /><span class="linenumbers">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="strings">"</span><span class="operators">),</span><span class="default">&nbsp;</span><span class="identifiers">argv</span><span class="operators">[</span><span class="numbers">1</span><span class="operators">]);</span>
<br /><span class="linenumbers">&nbsp;&nbsp;50&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="default">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="identifiers">LazyMessageBox</span><span class="operators">(</span><span class="identifiers">msg</span><span class="operators">);</span>
<br /><span class="linenumbers">&nbsp;&nbsp;51&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="default">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="identifiers">LocalFree</span><span class="operators">(</span><span class="identifiers">msg</span><span class="operators">);</span>
<br /><span class="linenumbers">&nbsp;&nbsp;52&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="default">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="keywords">return</span><span class="default">&nbsp;</span><span class="numbers">0</span><span class="operators">;</span><span class="default">&nbsp;
</span><br /><span class="linenumbers">&nbsp;&nbsp;53&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="default">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="operators">}</span>
<br /><span class="linenumbers">&nbsp;&nbsp;54&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="default">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="identifiers">filesize</span><span class="default">&nbsp;</span><span class="operators">=</span><span class="default">&nbsp;</span><span class="identifiers">GetFileSize</span><span class="operators">(</span><span class="identifiers">hFile</span><span class="operators">,</span><span class="default">&nbsp;</span><span class="identifiers">NULL</span><span class="operators">);</span>
<br /><span class="linenumbers">&nbsp;&nbsp;55&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="default">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="keywords">if</span><span class="default">&nbsp;</span><span class="operators">(</span><span class="identifiers">filesize</span><span class="default">&nbsp;</span><span class="operators">==</span><span class="default">&nbsp;</span><span class="identifiers">INVALID_FILE_SIZE</span><span class="operators">)</span>
<br /><span class="linenumbers">&nbsp;&nbsp;56&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="default">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="operators">{</span><span class="default">&nbsp;
</span><br /><span class="linenumbers">&nbsp;&nbsp;57&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="default">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="identifiers">DisplayError</span><span class="operators">(</span><span class="identifiers">TEXT</span><span class="operators">(</span><span class="strings">"GetFileSize"</span><span class="operators">));</span>
<br /><span class="linenumbers">&nbsp;&nbsp;58&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="default">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="keywords">return</span><span class="default">&nbsp;</span><span class="numbers">0</span><span class="operators">;</span><span class="default">&nbsp;
</span><br /><span class="linenumbers">&nbsp;&nbsp;59&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="default">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="operators">}</span>
<br /><span class="linenumbers">&nbsp;&nbsp;60&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="default">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="identifiers">hMap</span><span class="default">&nbsp;</span><span class="operators">=</span><span class="default">&nbsp;</span><span class="identifiers">CreateFileMapping</span><span class="operators">(</span><span class="identifiers">hFile</span><span class="operators">,</span><span class="default">&nbsp;</span><span class="identifiers">NULL</span><span class="operators">,</span><span class="default">&nbsp;</span><span class="identifiers">PAGE_READONLY</span><span class="operators">,</span><span class="default">&nbsp;</span><span class="numbers">0</span><span class="operators">,</span><span class="default">&nbsp;</span><span class="numbers">0</span><span class="operators">,</span><span class="default">&nbsp;</span><span class="identifiers">NULL</span><span class="operators">);</span>
<br /><span class="linenumbers">&nbsp;&nbsp;61&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="default">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="keywords">if</span><span class="operators">(</span><span class="identifiers">hMap</span><span class="default">&nbsp;</span><span class="operators">==</span><span class="default">&nbsp;</span><span class="identifiers">NULL</span><span class="operators">)</span><span class="default">&nbsp;</span><span class="operators">{</span>
<br /><span class="linenumbers">&nbsp;&nbsp;62&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="default">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="identifiers">DisplayError</span><span class="operators">(</span><span class="identifiers">TEXT</span><span class="operators">(</span><span class="strings">"CreateFileMapping"</span><span class="operators">));</span>
<br /><span class="linenumbers">&nbsp;&nbsp;63&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="default">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="keywords">return</span><span class="default">&nbsp;</span><span class="numbers">0</span><span class="operators">;</span><span class="default">&nbsp;
</span><br /><span class="linenumbers">&nbsp;&nbsp;64&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="default">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="operators">}</span>
<br /><span class="linenumbers">&nbsp;&nbsp;65&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="default">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="identifiers">p</span><span class="default">&nbsp;</span><span class="operators">=</span><span class="default">&nbsp;</span><span class="operators">(</span><span class="keywords">char</span><span class="operators">*)</span><span class="identifiers">MapViewOfFile</span><span class="operators">(</span><span class="identifiers">hMap</span><span class="operators">,</span><span class="default">&nbsp;</span><span class="identifiers">FILE_MAP_READ</span><span class="operators">,</span><span class="default">&nbsp;</span><span class="numbers">0</span><span class="operators">,</span><span class="default">&nbsp;</span><span class="numbers">0</span><span class="operators">,</span><span class="default">&nbsp;</span><span class="numbers">0</span><span class="operators">);</span>
<br /><span class="linenumbers">&nbsp;&nbsp;66&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="default">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="keywords">if</span><span class="operators">(</span><span class="identifiers">p</span><span class="default">&nbsp;</span><span class="operators">==</span><span class="default">&nbsp;</span><span class="identifiers">NULL</span><span class="operators">)</span><span class="default">&nbsp;</span><span class="operators">{</span>
<br /><span class="linenumbers">&nbsp;&nbsp;67&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="default">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="identifiers">DisplayError</span><span class="operators">(</span><span class="identifiers">TEXT</span><span class="operators">(</span><span class="strings">"MapViewOfFile"</span><span class="operators">));</span>
<br /><span class="linenumbers">&nbsp;&nbsp;68&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="default">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="keywords">return</span><span class="default">&nbsp;</span><span class="numbers">0</span><span class="operators">;</span><span class="default">&nbsp;
</span><br /><span class="linenumbers">&nbsp;&nbsp;69&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="default">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="operators">}</span>
<br /><span class="linenumbers">&nbsp;&nbsp;70&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="default">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="comments">//convert&nbsp;to&nbsp;ASCII
</span><br /><span class="linenumbers">&nbsp;&nbsp;71&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="default">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="identifiers">size_t</span><span class="default">&nbsp;</span><span class="identifiers">argvlen3</span><span class="default">&nbsp;</span><span class="operators">=</span><span class="default">&nbsp;</span><span class="identifiers">lstrlenA</span><span class="operators">(</span><span class="identifiers">InplaceCrudeWSTRToAscii</span><span class="operators">(</span><span class="identifiers">argv</span><span class="operators">[</span><span class="numbers">3</span><span class="operators">]));</span>
<br /><span class="linenumbers">&nbsp;&nbsp;72&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="default">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="identifiers">newfile</span><span class="default">&nbsp;</span><span class="operators">=</span><span class="default">&nbsp;</span><span class="operators">(</span><span class="keywords">char</span><span class="operators">*)</span><span class="identifiers">_alloca</span><span class="operators">(</span><span class="identifiers">filesize</span><span class="operators">+</span><span class="keywords">sizeof</span><span class="operators">(</span><span class="identifiers">NEWPATH</span><span class="operators">)+</span><span class="identifiers">argvlen3</span><span class="operators">+</span><span class="identifiers">argvlen4</span><span class="operators">);</span>
<br /><span class="linenumbers">&nbsp;&nbsp;73&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="default">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="keywords">char</span><span class="default">&nbsp;</span><span class="operators">*</span><span class="default">&nbsp;</span><span class="identifiers">filestart</span><span class="default">&nbsp;</span><span class="operators">=</span><span class="default">&nbsp;</span><span class="identifiers">StrStrA</span><span class="operators">(</span><span class="identifiers">p</span><span class="operators">,</span><span class="default">&nbsp;</span><span class="identifiers">ORIGPATH</span><span class="operators">);</span>
<br /><span class="linenumbers">&nbsp;&nbsp;74&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="default">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="keywords">if</span><span class="operators">(</span><span class="identifiers">filestart</span><span class="default">&nbsp;</span><span class="operators">==</span><span class="default">&nbsp;</span><span class="identifiers">NULL</span><span class="operators">)</span><span class="default">&nbsp;</span><span class="operators">{</span>
<br /><span class="linenumbers">&nbsp;&nbsp;75&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="default">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="identifiers">SetLastError</span><span class="operators">(</span><span class="identifiers">ERROR_INVALID_DATA</span><span class="operators">);</span>
<br /><span class="linenumbers">&nbsp;&nbsp;76&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="default">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="identifiers">DisplayError</span><span class="operators">(</span><span class="identifiers">TEXT</span><span class="operators">(</span><span class="strings">"strstr&nbsp;orig&nbsp;pdf&nbsp;path&nbsp;name&nbsp;not&nbsp;matched"</span><span class="operators">));</span>
<br /><span class="linenumbers">&nbsp;&nbsp;77&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="default">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="keywords">return</span><span class="default">&nbsp;</span><span class="numbers">0</span><span class="operators">;</span><span class="default">&nbsp;
</span><br /><span class="linenumbers">&nbsp;&nbsp;78&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="default">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="operators">}</span>
<br /><span class="linenumbers">&nbsp;&nbsp;79&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="default">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="identifiers">newfilecursor</span><span class="default">&nbsp;</span><span class="operators">=</span><span class="default">&nbsp;</span><span class="operators">(</span><span class="keywords">char</span><span class="operators">*)((</span><span class="identifiers">size_t</span><span class="operators">)</span><span class="identifiers">newfile</span><span class="operators">+(</span><span class="identifiers">size_t</span><span class="operators">)</span><span class="identifiers">filestart</span><span class="operators">-(</span><span class="identifiers">size_t</span><span class="operators">)</span><span class="identifiers">p</span><span class="operators">);</span>
<br /><span class="linenumbers">&nbsp;&nbsp;80&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="default">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="comments">//first&nbsp;half&nbsp;of&nbsp;file
</span><br /><span class="linenumbers">&nbsp;&nbsp;81&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="default">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="identifiers">memcpy</span><span class="operators">(</span><span class="identifiers">newfile</span><span class="operators">,</span><span class="default">&nbsp;</span><span class="identifiers">p</span><span class="operators">,</span><span class="default">&nbsp;</span><span class="identifiers">filestart</span><span class="operators">-</span><span class="identifiers">p</span><span class="operators">);</span>
<br /><span class="linenumbers">&nbsp;&nbsp;82&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="default">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="comments">//add&nbsp;new&nbsp;path&nbsp;header
</span><br /><span class="linenumbers">&nbsp;&nbsp;83&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="default">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="identifiers">memcpy</span><span class="operators">(</span><span class="identifiers">newfilecursor</span><span class="operators">,</span><span class="default">&nbsp;</span><span class="identifiers">NEWPATH</span><span class="operators">,</span><span class="default">&nbsp;</span><span class="keywords">sizeof</span><span class="operators">(</span><span class="identifiers">NEWPATH</span><span class="operators">)-</span><span class="numbers">1</span><span class="operators">);</span>
<br /><span class="linenumbers">&nbsp;&nbsp;84&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="default">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="identifiers">newfilecursor</span><span class="default">&nbsp;</span><span class="operators">+=</span><span class="default">&nbsp;</span><span class="keywords">sizeof</span><span class="operators">(</span><span class="identifiers">NEWPATH</span><span class="operators">)-</span><span class="numbers">1</span><span class="operators">;</span>
<br /><span class="linenumbers">&nbsp;&nbsp;85&nbsp;&nbsp;&nbsp;&nbsp;</span>
<br /><span class="linenumbers">&nbsp;&nbsp;86&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="default">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="identifiers">newfilecursor2</span><span class="default">&nbsp;</span><span class="operators">=</span><span class="default">&nbsp;</span><span class="identifiers">newfilecursor</span><span class="default">&nbsp;</span><span class="operators">+</span><span class="default">&nbsp;</span><span class="identifiers">argvlen3</span><span class="operators">;</span>
<br /><span class="linenumbers">&nbsp;&nbsp;87&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="default">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="comments">//copy&nbsp;.pdf&nbsp;file&nbsp;name
</span><br /><span class="linenumbers">&nbsp;&nbsp;88&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="default">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="identifiers">memcpy</span><span class="operators">(</span><span class="identifiers">newfilecursor</span><span class="operators">,</span><span class="default">&nbsp;</span><span class="identifiers">argv</span><span class="operators">[</span><span class="numbers">3</span><span class="operators">],</span><span class="default">&nbsp;</span><span class="identifiers">argvlen3</span><span class="operators">);</span>
<br /><span class="linenumbers">&nbsp;&nbsp;89&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="default">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="comments">//add&nbsp;end&nbsp;quote
</span><br /><span class="linenumbers">&nbsp;&nbsp;90&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="default">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="operators">*</span><span class="identifiers">newfilecursor2</span><span class="default">&nbsp;</span><span class="operators">=</span><span class="default">&nbsp;</span><span class="strings">'"'</span><span class="operators">;</span>
<br /><span class="linenumbers">&nbsp;&nbsp;91&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="default">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="identifiers">newfilecursor2</span><span class="operators">++;</span>
<br /><span class="linenumbers">&nbsp;&nbsp;92&nbsp;&nbsp;&nbsp;&nbsp;</span>
<br /><span class="linenumbers">&nbsp;&nbsp;93&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="default">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="identifiers">size_t</span><span class="default">&nbsp;</span><span class="identifiers">last_half_file</span><span class="default">&nbsp;</span><span class="operators">=</span><span class="default">&nbsp;</span><span class="identifiers">filesize</span><span class="operators">-(</span><span class="identifiers">filestart</span><span class="operators">+</span><span class="keywords">sizeof</span><span class="operators">(</span><span class="identifiers">ORIGPATH</span><span class="operators">)-</span><span class="numbers">1</span><span class="operators">-</span><span class="identifiers">p</span><span class="operators">);</span>
<br /><span class="linenumbers">&nbsp;&nbsp;94&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="default">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="operators">*(</span><span class="keywords">char</span><span class="operators">*)(</span><span class="identifiers">newfilecursor2</span><span class="operators">+</span><span class="identifiers">last_half_file</span><span class="operators">)</span><span class="default">&nbsp;</span><span class="operators">=</span><span class="default">&nbsp;</span><span class="strings">'\xDD'</span><span class="operators">;</span>
<br /><span class="linenumbers">&nbsp;&nbsp;95&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="default">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="comments">//copy&nbsp;last&nbsp;half&nbsp;of&nbsp;file
</span><br /><span class="linenumbers">&nbsp;&nbsp;96&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="default">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="identifiers">memcpy</span><span class="operators">(</span><span class="identifiers">newfilecursor2</span><span class="operators">,</span><span class="default">&nbsp;</span><span class="identifiers">filestart</span><span class="operators">+</span><span class="keywords">sizeof</span><span class="operators">(</span><span class="identifiers">ORIGPATH</span><span class="operators">)-</span><span class="numbers">1</span><span class="operators">,</span><span class="default">&nbsp;</span><span class="identifiers">last_half_file</span><span class="operators">);</span>
<br /><span class="linenumbers">&nbsp;&nbsp;97&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="default">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="operators">*(</span><span class="identifiers">newfilecursor2</span><span class="operators">+</span><span class="identifiers">last_half_file</span><span class="operators">)</span><span class="default">&nbsp;</span><span class="operators">=</span><span class="default">&nbsp;</span><span class="strings">'\0'</span><span class="operators">;</span>
<br /><span class="linenumbers">&nbsp;&nbsp;98&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="default">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="identifiers">newfilecursor2</span><span class="default">&nbsp;</span><span class="operators">=</span><span class="default">&nbsp;</span><span class="identifiers">StrStrA</span><span class="operators">(</span><span class="identifiers">newfile</span><span class="operators">,</span><span class="default">&nbsp;</span><span class="strings">"original=\""</span><span class="operators">);</span>
<br /><span class="linenumbers">&nbsp;&nbsp;99&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="default">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="keywords">if</span><span class="operators">(</span><span class="identifiers">newfilecursor2</span><span class="default">&nbsp;</span><span class="operators">==</span><span class="default">&nbsp;</span><span class="identifiers">NULL</span><span class="operators">)</span><span class="default">&nbsp;</span><span class="operators">{</span>
<br /><span class="linenumbers">&nbsp;100&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="default">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="identifiers">SetLastError</span><span class="operators">(</span><span class="identifiers">ERROR_INVALID_DATA</span><span class="operators">);</span>
<br /><span class="linenumbers">&nbsp;101&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="default">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="identifiers">DisplayError</span><span class="operators">(</span><span class="identifiers">TEXT</span><span class="operators">(</span><span class="strings">"strstr&nbsp;orignal&nbsp;SHA1&nbsp;ID&nbsp;not&nbsp;found"</span><span class="operators">));</span>
<br /><span class="linenumbers">&nbsp;102&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="default">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="keywords">return</span><span class="default">&nbsp;</span><span class="numbers">0</span><span class="operators">;</span><span class="default">&nbsp;
</span><br /><span class="linenumbers">&nbsp;103&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="default">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="operators">}</span>
<br /><span class="linenumbers">&nbsp;104&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="default">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="identifiers">memcpy</span><span class="operators">(</span><span class="identifiers">newfilecursor2</span><span class="operators">+</span><span class="keywords">sizeof</span><span class="operators">(</span><span class="strings">"original=\""</span><span class="operators">)-</span><span class="numbers">1</span><span class="operators">,</span><span class="default">&nbsp;</span><span class="identifiers">argv</span><span class="operators">[</span><span class="numbers">4</span><span class="operators">],</span><span class="default">&nbsp;</span><span class="numbers">32</span><span class="operators">);</span>
<br /><span class="linenumbers">&nbsp;105&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="default">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="identifiers">CloseHandle</span><span class="operators">(</span><span class="identifiers">hMap</span><span class="operators">);</span>
<br /><span class="linenumbers">&nbsp;106&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="default">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="identifiers">CloseHandle</span><span class="operators">(</span><span class="identifiers">hFile</span><span class="operators">);</span>
<br /><span class="linenumbers">&nbsp;107&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="default">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="identifiers">LocalFree</span><span class="operators">(</span><span class="identifiers">argv</span><span class="operators">);</span>
<br /><span class="linenumbers">&nbsp;108&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="default">&nbsp;&nbsp;&nbsp;&nbsp;
</span><br /><span class="linenumbers">&nbsp;109&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="default">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="identifiers">TCHAR</span><span class="default">&nbsp;</span><span class="identifiers">szTempFileName</span><span class="operators">[</span><span class="identifiers">MAX_PATH</span><span class="operators">];</span><span class="default">&nbsp;&nbsp;
</span><br /><span class="linenumbers">&nbsp;110&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="default">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="identifiers">TCHAR</span><span class="default">&nbsp;</span><span class="identifiers">lpTempPathBuffer</span><span class="operators">[</span><span class="identifiers">MAX_PATH</span><span class="operators">];</span>
<br /><span class="linenumbers">&nbsp;111&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="default">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="identifiers">DWORD</span><span class="default">&nbsp;</span><span class="identifiers">dwRetVal</span><span class="operators">;</span>
<br /><span class="linenumbers">&nbsp;112&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="default">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="comments">//&nbsp;&nbsp;Gets&nbsp;the&nbsp;temp&nbsp;path&nbsp;env&nbsp;string&nbsp;(no&nbsp;guarantee&nbsp;it's&nbsp;a&nbsp;valid&nbsp;path).
</span><br /><span class="linenumbers">&nbsp;113&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="default">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="identifiers">dwRetVal</span><span class="default">&nbsp;</span><span class="operators">=</span><span class="default">&nbsp;</span><span class="identifiers">GetTempPath</span><span class="operators">(</span><span class="identifiers">MAX_PATH</span><span class="operators">,</span><span class="default">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="comments">//&nbsp;length&nbsp;of&nbsp;the&nbsp;buffer
</span><br /><span class="linenumbers">&nbsp;114&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="default">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="identifiers">lpTempPathBuffer</span><span class="operators">);</span><span class="default">&nbsp;</span><span class="comments">//&nbsp;buffer&nbsp;for&nbsp;path&nbsp;
</span><br /><span class="linenumbers">&nbsp;115&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="default">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="keywords">if</span><span class="default">&nbsp;</span><span class="operators">(</span><span class="identifiers">dwRetVal</span><span class="default">&nbsp;</span><span class="operators">&gt;</span><span class="default">&nbsp;</span><span class="identifiers">MAX_PATH</span><span class="default">&nbsp;</span><span class="operators">||</span><span class="default">&nbsp;</span><span class="operators">(</span><span class="identifiers">dwRetVal</span><span class="default">&nbsp;</span><span class="operators">==</span><span class="default">&nbsp;</span><span class="numbers">0</span><span class="operators">))</span>
<br /><span class="linenumbers">&nbsp;116&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="default">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="operators">{</span>
<br /><span class="linenumbers">&nbsp;117&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="default">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="identifiers">DisplayError</span><span class="operators">(</span><span class="identifiers">TEXT</span><span class="operators">(</span><span class="strings">"GetTempPath"</span><span class="operators">));</span>
<br /><span class="linenumbers">&nbsp;118&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="default">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="keywords">return</span><span class="default">&nbsp;</span><span class="numbers">0</span><span class="operators">;</span>
<br /><span class="linenumbers">&nbsp;119&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="default">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="operators">}</span>
<br /><span class="linenumbers">&nbsp;120&nbsp;&nbsp;&nbsp;&nbsp;</span>
<br /><span class="linenumbers">&nbsp;121&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="default">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="comments">//&nbsp;&nbsp;Generates&nbsp;a&nbsp;temporary&nbsp;file&nbsp;name.&nbsp;
</span><br /><span class="linenumbers">&nbsp;122&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="default">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="identifiers">dwRetVal</span><span class="default">&nbsp;</span><span class="operators">=</span><span class="default">&nbsp;</span><span class="identifiers">GetTempFileName</span><span class="operators">(</span><span class="identifiers">lpTempPathBuffer</span><span class="operators">,</span><span class="default">&nbsp;</span><span class="comments">//&nbsp;directory&nbsp;for&nbsp;tmp&nbsp;files
</span><br /><span class="linenumbers">&nbsp;123&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="default">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="identifiers">TEXT</span><span class="operators">(</span><span class="strings">"lab"</span><span class="operators">),</span><span class="default">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="comments">//&nbsp;temp&nbsp;file&nbsp;name&nbsp;prefix&nbsp;
</span><br /><span class="linenumbers">&nbsp;124&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="default">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="numbers">0</span><span class="operators">,</span><span class="default">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="comments">//&nbsp;create&nbsp;unique&nbsp;name&nbsp;
</span><br /><span class="linenumbers">&nbsp;125&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="default">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="identifiers">szTempFileName</span><span class="operators">);</span><span class="default">&nbsp;&nbsp;</span><span class="comments">//&nbsp;buffer&nbsp;for&nbsp;name&nbsp;
</span><br /><span class="linenumbers">&nbsp;126&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="default">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="keywords">if</span><span class="default">&nbsp;</span><span class="operators">(</span><span class="identifiers">dwRetVal</span><span class="default">&nbsp;</span><span class="operators">==</span><span class="default">&nbsp;</span><span class="numbers">0</span><span class="operators">)</span>
<br /><span class="linenumbers">&nbsp;127&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="default">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="operators">{</span>
<br /><span class="linenumbers">&nbsp;128&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="default">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="identifiers">DisplayError</span><span class="operators">(</span><span class="identifiers">TEXT</span><span class="operators">(</span><span class="strings">"GetTempFileName"</span><span class="operators">));</span>
<br /><span class="linenumbers">&nbsp;129&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="default">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="keywords">return</span><span class="default">&nbsp;</span><span class="numbers">0</span><span class="operators">;</span>
<br /><span class="linenumbers">&nbsp;130&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="default">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="operators">}</span>
<br /><span class="linenumbers">&nbsp;131&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="default">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="comments">//rename&nbsp;.tmp&nbsp;to&nbsp;.xfdf
</span><br /><span class="linenumbers">&nbsp;132&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="default">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="identifiers">memcpy</span><span class="operators">(</span><span class="identifiers">szTempFileName</span><span class="operators">+(</span><span class="identifiers">lstrlen</span><span class="operators">(</span><span class="identifiers">szTempFileName</span><span class="operators">)-</span><span class="numbers">3</span><span class="operators">),</span><span class="default">&nbsp;</span><span class="identifiers">TEXT</span><span class="operators">(</span><span class="strings">"xfdf"</span><span class="operators">),</span><span class="default">&nbsp;</span><span class="keywords">sizeof</span><span class="operators">(</span><span class="identifiers">TEXT</span><span class="operators">(</span><span class="strings">"xfdf"</span><span class="operators">)));</span>
<br /><span class="linenumbers">&nbsp;133&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="default">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="identifiers">hFile</span><span class="default">&nbsp;</span><span class="operators">=</span><span class="default">&nbsp;</span><span class="identifiers">CreateFile</span><span class="operators">((</span><span class="identifiers">LPTSTR</span><span class="operators">)</span><span class="default">&nbsp;</span><span class="identifiers">szTempFileName</span><span class="operators">,</span><span class="default">&nbsp;</span><span class="comments">//&nbsp;file&nbsp;name&nbsp;
</span><br /><span class="linenumbers">&nbsp;134&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="default">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="operators">(</span><span class="identifiers">GENERIC_READ</span><span class="default">&nbsp;</span><span class="operators">|</span><span class="default">&nbsp;</span><span class="identifiers">GENERIC_WRITE</span><span class="operators">),</span><span class="default">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="comments">//&nbsp;open&nbsp;for&nbsp;write&nbsp;
</span><br /><span class="linenumbers">&nbsp;135&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="default">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="identifiers">FILE_SHARE_READ</span><span class="default">&nbsp;</span><span class="operators">|</span><span class="default">&nbsp;</span><span class="identifiers">FILE_SHARE_WRITE</span><span class="default">&nbsp;</span><span class="operators">|</span><span class="default">&nbsp;</span><span class="identifiers">FILE_SHARE_DELETE</span><span class="operators">,</span>
<br /><span class="linenumbers">&nbsp;136&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="default">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="identifiers">NULL</span><span class="operators">,</span><span class="default">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="comments">//&nbsp;default&nbsp;security&nbsp;
</span><br /><span class="linenumbers">&nbsp;137&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="default">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="identifiers">CREATE_ALWAYS</span><span class="operators">,</span><span class="default">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="comments">//&nbsp;overwrite&nbsp;existing
</span><br /><span class="linenumbers">&nbsp;138&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="default">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="identifiers">FILE_ATTRIBUTE_NORMAL</span><span class="operators">,</span>
<br /><span class="linenumbers">&nbsp;139&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="default">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="identifiers">NULL</span><span class="operators">);</span><span class="default">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="comments">//&nbsp;no&nbsp;template&nbsp;
</span><br /><span class="linenumbers">&nbsp;140&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="default">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="keywords">if</span><span class="default">&nbsp;</span><span class="operators">(</span><span class="identifiers">hFile</span><span class="default">&nbsp;</span><span class="operators">==</span><span class="default">&nbsp;</span><span class="identifiers">INVALID_HANDLE_VALUE</span><span class="operators">)</span><span class="default">&nbsp;
</span><br /><span class="linenumbers">&nbsp;141&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="default">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="operators">{</span><span class="default">&nbsp;
</span><br /><span class="linenumbers">&nbsp;142&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="default">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="identifiers">DisplayError</span><span class="operators">(</span><span class="identifiers">TEXT</span><span class="operators">(</span><span class="strings">"CreateFile"</span><span class="operators">));</span>
<br /><span class="linenumbers">&nbsp;143&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="default">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="identifiers">LPWSTR</span><span class="default">&nbsp;</span><span class="identifiers">msg</span><span class="default">&nbsp;</span><span class="operators">=</span><span class="default">&nbsp;</span><span class="identifiers">GetFormattedMessage</span><span class="operators">(</span><span class="identifiers">TEXT</span><span class="operators">(</span><span class="strings">"Terminal&nbsp;failure:&nbsp;unable&nbsp;to&nbsp;open&nbsp;file&nbsp;\"%1!s!\"&nbsp;for&nbsp;write</span><br /><span class="linenumbers">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="strings">."</span><span class="operators">),</span><span class="default">&nbsp;</span><span class="identifiers">szTempFileName</span><span class="operators">);</span>
<br /><span class="linenumbers">&nbsp;144&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="default">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="identifiers">LazyMessageBox</span><span class="operators">(</span><span class="identifiers">msg</span><span class="operators">);</span>
<br /><span class="linenumbers">&nbsp;145&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="default">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="identifiers">LocalFree</span><span class="operators">(</span><span class="identifiers">msg</span><span class="operators">);</span>
<br /><span class="linenumbers">&nbsp;146&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="default">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="keywords">return</span><span class="default">&nbsp;</span><span class="numbers">0</span><span class="operators">;</span><span class="default">&nbsp;
</span><br /><span class="linenumbers">&nbsp;147&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="default">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="operators">}</span>
<br /><span class="linenumbers">&nbsp;148&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="default">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="keywords">if</span><span class="default">&nbsp;</span><span class="operators">(!</span><span class="identifiers">WriteFile</span><span class="operators">(</span><span class="identifiers">hFile</span><span class="operators">,</span><span class="default">&nbsp;
</span><br /><span class="linenumbers">&nbsp;149&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="default">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="identifiers">newfile</span><span class="operators">,</span><span class="default">&nbsp;
</span><br /><span class="linenumbers">&nbsp;150&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="default">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="operators">(</span><span class="identifiers">DWORD</span><span class="operators">)</span><span class="identifiers">lstrlenA</span><span class="operators">(</span><span class="identifiers">newfile</span><span class="operators">),</span>
<br /><span class="linenumbers">&nbsp;151&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="default">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="operators">&amp;</span><span class="identifiers">dwBytesWritten</span><span class="operators">,</span><span class="default">&nbsp;
</span><br /><span class="linenumbers">&nbsp;152&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="default">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="identifiers">NULL</span><span class="operators">))</span><span class="default">&nbsp;
</span><br /><span class="linenumbers">&nbsp;153&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="default">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="operators">{</span>
<br /><span class="linenumbers">&nbsp;154&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="default">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="identifiers">DisplayError</span><span class="operators">(</span><span class="identifiers">TEXT</span><span class="operators">(</span><span class="strings">"WriteFile"</span><span class="operators">));</span>
<br /><span class="linenumbers">&nbsp;155&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="default">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="keywords">return</span><span class="default">&nbsp;</span><span class="numbers">0</span><span class="operators">;</span>
<br /><span class="linenumbers">&nbsp;156&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="default">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="operators">}</span>
<br /><span class="linenumbers">&nbsp;157&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="default">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="identifiers">CloseHandle</span><span class="operators">(</span><span class="identifiers">hFile</span><span class="operators">);</span>
<br /><span class="linenumbers">&nbsp;158&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="default">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="identifiers">HINSTANCE</span><span class="default">&nbsp;</span><span class="identifiers">err</span><span class="default">&nbsp;</span><span class="operators">=</span><span class="default">&nbsp;</span><span class="identifiers">ShellExecute</span><span class="operators">(</span>
<br /><span class="linenumbers">&nbsp;159&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="default">&nbsp;&nbsp;</span><span class="identifiers">NULL</span><span class="operators">,</span>
<br /><span class="linenumbers">&nbsp;160&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="default">&nbsp;&nbsp;</span><span class="identifiers">TEXT</span><span class="operators">(</span><span class="strings">"Open"</span><span class="operators">),</span>
<br /><span class="linenumbers">&nbsp;161&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="default">&nbsp;&nbsp;</span><span class="identifiers">szTempFileName</span><span class="operators">,</span>
<br /><span class="linenumbers">&nbsp;162&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="default">&nbsp;&nbsp;</span><span class="identifiers">NULL</span><span class="operators">,</span>
<br /><span class="linenumbers">&nbsp;163&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="default">&nbsp;&nbsp;</span><span class="identifiers">NULL</span><span class="operators">,</span>
<br /><span class="linenumbers">&nbsp;164&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="default">&nbsp;&nbsp;</span><span class="identifiers">SW_SHOWNORMAL</span>
<br /><span class="linenumbers">&nbsp;165&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="operators">);</span>
<br /><span class="linenumbers">&nbsp;166&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="default">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="keywords">if</span><span class="operators">(</span><span class="identifiers">err</span><span class="default">&nbsp;</span><span class="operators">&lt;=</span><span class="default">&nbsp;</span><span class="operators">(</span><span class="identifiers">HINSTANCE</span><span class="operators">)</span><span class="numbers">32</span><span class="operators">)</span><span class="default">&nbsp;</span><span class="operators">{</span>
<br /><span class="linenumbers">&nbsp;167&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="default">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="identifiers">SetLastError</span><span class="operators">((</span><span class="identifiers">DWORD</span><span class="operators">)</span><span class="identifiers">err</span><span class="operators">);</span>
<br /><span class="linenumbers">&nbsp;168&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="default">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="identifiers">DisplayError</span><span class="operators">(</span><span class="identifiers">TEXT</span><span class="operators">(</span><span class="strings">"ShellExecute"</span><span class="operators">));</span>
<br /><span class="linenumbers">&nbsp;169&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="default">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="operators">}</span>
<br /><span class="linenumbers">&nbsp;170&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="default">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="identifiers">Sleep</span><span class="operators">(</span><span class="numbers">5000</span><span class="operators">);</span>
<br /><span class="linenumbers">&nbsp;171&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="default">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="keywords">if</span><span class="default">&nbsp;</span><span class="operators">(!</span><span class="identifiers">DeleteFile</span><span class="operators">(</span><span class="identifiers">szTempFileName</span><span class="operators">)){</span>
<br /><span class="linenumbers">&nbsp;172&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="default">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="identifiers">DisplayError</span><span class="operators">(</span><span class="identifiers">TEXT</span><span class="operators">(</span><span class="strings">"DeleteFile"</span><span class="operators">));</span>
<br /><span class="linenumbers">&nbsp;173&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="default">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="keywords">return</span><span class="default">&nbsp;</span><span class="numbers">0</span><span class="operators">;</span>
<br /><span class="linenumbers">&nbsp;174&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="default">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="operators">}</span>
<br /><span class="linenumbers">&nbsp;175&nbsp;&nbsp;&nbsp;&nbsp;</span>
<br /><span class="linenumbers">&nbsp;176&nbsp;&nbsp;&nbsp;&nbsp;</span>
<br /><span class="linenumbers">&nbsp;177&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="default">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="keywords">return</span><span class="default">&nbsp;</span><span class="numbers">0</span><span class="operators">;</span>
<br /><span class="linenumbers">&nbsp;178&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="operators">}</span>
<br /><span class="linenumbers">&nbsp;179&nbsp;&nbsp;&nbsp;&nbsp;</span>
<br /><span class="linenumbers">&nbsp;180&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="keywords">char</span><span class="default">&nbsp;</span><span class="operators">*</span><span class="default">&nbsp;</span><span class="identifiers">InplaceCrudeWSTRToAscii</span><span class="operators">(</span><span class="identifiers">LPWSTR</span><span class="default">&nbsp;</span><span class="identifiers">wstr</span><span class="operators">)</span><span class="default">&nbsp;</span><span class="operators">{</span>
<br /><span class="linenumbers">&nbsp;181&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="default">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="keywords">unsigned</span><span class="default">&nbsp;</span><span class="keywords">int</span><span class="default">&nbsp;</span><span class="identifiers">i</span><span class="default">&nbsp;</span><span class="operators">=</span><span class="default">&nbsp;</span><span class="numbers">0</span><span class="operators">;</span>
<br /><span class="linenumbers">&nbsp;182&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="default">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="keywords">char</span><span class="default">&nbsp;</span><span class="operators">*</span><span class="default">&nbsp;</span><span class="identifiers">origstr</span><span class="default">&nbsp;</span><span class="operators">=</span><span class="default">&nbsp;</span><span class="operators">(</span><span class="keywords">char</span><span class="default">&nbsp;</span><span class="operators">*)</span><span class="identifiers">wstr</span><span class="operators">;</span>
<br /><span class="linenumbers">&nbsp;183&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="default">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="keywords">char</span><span class="default">&nbsp;</span><span class="operators">*</span><span class="default">&nbsp;</span><span class="identifiers">str</span><span class="default">&nbsp;</span><span class="operators">=</span><span class="default">&nbsp;</span><span class="operators">(</span><span class="keywords">char</span><span class="default">&nbsp;</span><span class="operators">*)</span><span class="identifiers">wstr</span><span class="operators">;</span>
<br /><span class="linenumbers">&nbsp;184&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="default">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="keywords">while</span><span class="operators">(*</span><span class="identifiers">wstr</span><span class="default">&nbsp;</span><span class="operators">!=</span><span class="default">&nbsp;</span><span class="numbers">0</span><span class="operators">)</span><span class="default">&nbsp;</span><span class="operators">{</span>
<br /><span class="linenumbers">&nbsp;185&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="default">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="keywords">char</span><span class="default">&nbsp;</span><span class="identifiers">c</span><span class="default">&nbsp;</span><span class="operators">=</span><span class="default">&nbsp;</span><span class="operators">(</span><span class="keywords">char</span><span class="operators">)*</span><span class="identifiers">wstr</span><span class="operators">;</span>
<br /><span class="linenumbers">&nbsp;186&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="default">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="operators">*</span><span class="identifiers">wstr</span><span class="default">&nbsp;</span><span class="operators">=</span><span class="default">&nbsp;</span><span class="numbers">0</span><span class="operators">;</span>
<br /><span class="linenumbers">&nbsp;187&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="default">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="identifiers">wstr</span><span class="operators">++;</span>
<br /><span class="linenumbers">&nbsp;188&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="default">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="operators">*((</span><span class="keywords">char</span><span class="default">&nbsp;</span><span class="operators">*)</span><span class="identifiers">str</span><span class="operators">)</span><span class="default">&nbsp;</span><span class="operators">=</span><span class="default">&nbsp;</span><span class="identifiers">c</span><span class="operators">;</span>
<br /><span class="linenumbers">&nbsp;189&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="default">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="identifiers">str</span><span class="operators">++;</span>
<br /><span class="linenumbers">&nbsp;190&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="default">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="operators">}</span>
<br /><span class="linenumbers">&nbsp;191&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="default">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="operators">*</span><span class="identifiers">str</span><span class="default">&nbsp;</span><span class="operators">=</span><span class="strings">'\0'</span><span class="operators">;</span>
<br /><span class="linenumbers">&nbsp;192&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="default">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="keywords">return</span><span class="default">&nbsp;</span><span class="identifiers">origstr</span><span class="operators">;</span>
<br /><span class="linenumbers">&nbsp;193&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="operators">}</span>
<br /><span class="linenumbers">&nbsp;194&nbsp;&nbsp;&nbsp;&nbsp;</span>
<br /><span class="linenumbers">&nbsp;195&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="keywords">void</span><span class="default">&nbsp;</span><span class="identifiers">DisplayError</span><span class="operators">(</span><span class="identifiers">LPTSTR</span><span class="default">&nbsp;</span><span class="identifiers">lpszFunction</span><span class="operators">)</span><span class="default">&nbsp;
</span><br /><span class="linenumbers">&nbsp;196&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="comments">//&nbsp;Routine&nbsp;Description:
</span><br /><span class="linenumbers">&nbsp;197&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="comments">//&nbsp;Retrieve&nbsp;and&nbsp;output&nbsp;the&nbsp;system&nbsp;error&nbsp;message&nbsp;for&nbsp;the&nbsp;last-error&nbsp;code
</span><br /><span class="linenumbers">&nbsp;198&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="operators">{</span><span class="default">&nbsp;
</span><br /><span class="linenumbers">&nbsp;199&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="default">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="identifiers">LPTSTR</span><span class="default">&nbsp;</span><span class="identifiers">lpMsgBuf</span><span class="operators">;</span>
<br /><span class="linenumbers">&nbsp;200&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="default">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="identifiers">DWORD</span><span class="default">&nbsp;</span><span class="identifiers">dw</span><span class="default">&nbsp;</span><span class="operators">=</span><span class="default">&nbsp;</span><span class="identifiers">GetLastError</span><span class="operators">();</span><span class="default">&nbsp;
</span><br /><span class="linenumbers">&nbsp;201&nbsp;&nbsp;&nbsp;&nbsp;</span>
<br /><span class="linenumbers">&nbsp;202&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="default">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="identifiers">FormatMessage</span><span class="operators">(</span>
<br /><span class="linenumbers">&nbsp;203&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="default">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="identifiers">FORMAT_MESSAGE_ALLOCATE_BUFFER</span><span class="default">&nbsp;</span><span class="operators">|</span><span class="default">&nbsp;
</span><br /><span class="linenumbers">&nbsp;204&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="default">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="identifiers">FORMAT_MESSAGE_FROM_SYSTEM</span><span class="default">&nbsp;</span><span class="operators">|</span>
<br /><span class="linenumbers">&nbsp;205&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="default">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="identifiers">FORMAT_MESSAGE_IGNORE_INSERTS</span><span class="operators">,</span>
<br /><span class="linenumbers">&nbsp;206&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="default">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="identifiers">NULL</span><span class="operators">,</span>
<br /><span class="linenumbers">&nbsp;207&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="default">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="identifiers">dw</span><span class="operators">,</span>
<br /><span class="linenumbers">&nbsp;208&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="default">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="identifiers">MAKELANGID</span><span class="operators">(</span><span class="identifiers">LANG_NEUTRAL</span><span class="operators">,</span><span class="default">&nbsp;</span><span class="identifiers">SUBLANG_DEFAULT</span><span class="operators">),</span>
<br /><span class="linenumbers">&nbsp;209&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="default">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="operators">(</span><span class="identifiers">LPTSTR</span><span class="operators">)</span><span class="default">&nbsp;</span><span class="operators">&amp;</span><span class="identifiers">lpMsgBuf</span><span class="operators">,</span>
<br /><span class="linenumbers">&nbsp;210&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="default">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="numbers">0</span><span class="operators">,</span><span class="default">&nbsp;
</span><br /><span class="linenumbers">&nbsp;211&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="default">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="identifiers">NULL</span><span class="default">&nbsp;</span><span class="operators">);</span>
<br /><span class="linenumbers">&nbsp;212&nbsp;&nbsp;&nbsp;&nbsp;</span>
<br /><span class="linenumbers">&nbsp;213&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="default">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="identifiers">LPWSTR</span><span class="default">&nbsp;</span><span class="identifiers">msg</span><span class="default">&nbsp;</span><span class="operators">=</span>
<br /><span class="linenumbers">&nbsp;214&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="default">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="identifiers">GetFormattedMessage</span><span class="operators">(</span>
<br /><span class="linenumbers">&nbsp;215&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="default">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="identifiers">TEXT</span><span class="operators">(</span><span class="strings">"ERROR:&nbsp;%1!s!&nbsp;failed&nbsp;with&nbsp;error&nbsp;code&nbsp;%2!d!&nbsp;as&nbsp;follows:\n%3!s!"</span><span class="operators">),</span>
<br /><span class="linenumbers">&nbsp;216&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="default">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="identifiers">lpszFunction</span><span class="operators">,</span><span class="default">&nbsp;
</span><br /><span class="linenumbers">&nbsp;217&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="default">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="identifiers">dw</span><span class="operators">,</span><span class="default">&nbsp;
</span><br /><span class="linenumbers">&nbsp;218&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="default">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="identifiers">lpMsgBuf</span>
<br /><span class="linenumbers">&nbsp;219&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="default">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="operators">);</span>
<br /><span class="linenumbers">&nbsp;220&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="default">&nbsp;&nbsp;&nbsp;&nbsp;
</span><br /><span class="linenumbers">&nbsp;221&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="default">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="identifiers">LazyMessageBox</span><span class="operators">(</span><span class="identifiers">msg</span><span class="operators">);</span>
<br /><span class="linenumbers">&nbsp;222&nbsp;&nbsp;&nbsp;&nbsp;</span>
<br /><span class="linenumbers">&nbsp;223&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="default">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="identifiers">LocalFree</span><span class="operators">(</span><span class="identifiers">lpMsgBuf</span><span class="operators">);</span>
<br /><span class="linenumbers">&nbsp;224&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="default">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="identifiers">LocalFree</span><span class="operators">(</span><span class="identifiers">msg</span><span class="operators">);</span>
<br /><span class="linenumbers">&nbsp;225&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="operators">}</span>
<br /><span class="linenumbers">&nbsp;226&nbsp;&nbsp;&nbsp;&nbsp;</span>
<br /><span class="linenumbers">&nbsp;227&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="keywords">void</span>
<br /><span class="linenumbers">&nbsp;228&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="identifiers">WINAPI</span>
<br /><span class="linenumbers">&nbsp;229&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="identifiers">LazyMessageBox</span><span class="operators">(</span><span class="identifiers">LPCTSTR</span><span class="default">&nbsp;</span><span class="identifiers">str</span><span class="operators">)</span><span class="default">&nbsp;</span><span class="operators">{</span>
<br /><span class="linenumbers">&nbsp;230&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="default">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="identifiers">HMODULE</span><span class="default">&nbsp;</span><span class="identifiers">module</span><span class="default">&nbsp;</span><span class="operators">=</span><span class="default">&nbsp;</span><span class="identifiers">LoadLibrary</span><span class="operators">(</span><span class="identifiers">_T</span><span class="operators">(</span><span class="strings">"user32.dll"</span><span class="operators">));</span>
<br /><span class="linenumbers">&nbsp;231&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="preprocessor">#ifdef&nbsp;UNICODE
</span><br /><span class="linenumbers">&nbsp;232&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="default">&nbsp;</span><span class="keywords">int</span><span class="default">&nbsp;</span><span class="operators">(</span><span class="identifiers">WINAPI</span><span class="default">&nbsp;</span><span class="operators">*</span><span class="default">&nbsp;</span><span class="identifiers">pfnMessageBox</span><span class="operators">)(</span><span class="identifiers">HWND</span><span class="operators">,</span><span class="default">&nbsp;</span><span class="identifiers">LPCTSTR</span><span class="operators">,</span><span class="default">&nbsp;</span><span class="identifiers">LPCTSTR</span><span class="operators">,</span><span class="default">&nbsp;</span><span class="identifiers">UINT</span><span class="operators">)</span><span class="default">&nbsp;</span><span class="operators">=</span><span class="default">&nbsp;</span><span class="operators">(</span><span class="keywords">int</span><span class="default">&nbsp;</span><span class="operators">(</span><span class="identifiers">WINAPI</span><span class="default">&nbsp;</span><span class="operators">*)(</span><span class="identifiers">HWND</span><span class="operators">,</span><span class="default">&nbsp;</span><span class="identifiers">LPCTSTR</span><span class="operators">,</span><span class="default">&nbsp;</span><span class="identifiers">LPCT</span><br /><span class="linenumbers">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="identifiers">STR</span><span class="operators">,</span><span class="default">&nbsp;</span><span class="identifiers">UINT</span><span class="operators">))</span><span class="default">&nbsp;</span><span class="identifiers">GetProcAddress</span><span class="operators">(</span><span class="identifiers">module</span><span class="operators">,</span><span class="default">&nbsp;</span><span class="strings">"MessageBoxW"</span><span class="operators">);</span>
<br /><span class="linenumbers">&nbsp;233&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="preprocessor">#else
</span><br /><span class="linenumbers">&nbsp;234&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="default">&nbsp;</span><span class="keywords">int</span><span class="default">&nbsp;</span><span class="operators">(</span><span class="identifiers">WINAPI</span><span class="default">&nbsp;</span><span class="operators">*</span><span class="default">&nbsp;</span><span class="identifiers">pfnMessageBox</span><span class="operators">)(</span><span class="identifiers">HWND</span><span class="operators">,</span><span class="default">&nbsp;</span><span class="identifiers">LPCTSTR</span><span class="operators">,</span><span class="default">&nbsp;</span><span class="identifiers">LPCTSTR</span><span class="operators">,</span><span class="default">&nbsp;</span><span class="identifiers">UINT</span><span class="operators">)</span><span class="default">&nbsp;</span><span class="identifiers">pfnMessageBox</span><span class="default">&nbsp;</span><span class="operators">=</span><span class="default">&nbsp;</span><span class="operators">(</span><span class="keywords">int</span><span class="default">&nbsp;</span><span class="operators">(</span><span class="identifiers">WINAPI</span><span class="default">&nbsp;</span><span class="operators">*)(</span><span class="identifiers">HWND</span><span class="operators">,</span><br /><span class="linenumbers">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="default">&nbsp;</span><span class="identifiers">LPCTSTR</span><span class="operators">,</span><span class="default">&nbsp;</span><span class="identifiers">LPCTSTR</span><span class="operators">,</span><span class="default">&nbsp;</span><span class="identifiers">UINT</span><span class="operators">))</span><span class="default">&nbsp;</span><span class="identifiers">GetProcAddress</span><span class="operators">(</span><span class="identifiers">module</span><span class="operators">,</span><span class="default">&nbsp;</span><span class="strings">"MessageBoxA"</span><span class="operators">);</span>
<br /><span class="linenumbers">&nbsp;235&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="preprocessor">#endif
</span><br /><span class="linenumbers">&nbsp;236&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="default">&nbsp;</span><span class="identifiers">pfnMessageBox</span><span class="operators">(</span><span class="identifiers">NULL</span><span class="operators">,</span><span class="default">&nbsp;</span><span class="identifiers">str</span><span class="operators">,</span><span class="default">&nbsp;</span><span class="identifiers">NULL</span><span class="operators">,</span><span class="default">&nbsp;</span><span class="identifiers">MB_ICONSTOP</span><span class="operators">);</span>
<br /><span class="linenumbers">&nbsp;237&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="default">&nbsp;</span><span class="keywords">return</span><span class="operators">;</span>
<br /><span class="linenumbers">&nbsp;238&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="operators">}</span>
<br /><span class="linenumbers">&nbsp;239&nbsp;&nbsp;&nbsp;&nbsp;</span>
<br /><span class="linenumbers">&nbsp;240&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="comments">//&nbsp;Formats&nbsp;a&nbsp;message&nbsp;string&nbsp;using&nbsp;the&nbsp;specified&nbsp;message&nbsp;and&nbsp;variable
</span><br /><span class="linenumbers">&nbsp;241&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="comments">//&nbsp;list&nbsp;of&nbsp;arguments.
</span><br /><span class="linenumbers">&nbsp;242&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="identifiers">LPTSTR</span><span class="default">&nbsp;</span><span class="identifiers">GetFormattedMessage</span><span class="operators">(</span><span class="identifiers">LPCTSTR</span><span class="default">&nbsp;</span><span class="identifiers">pMessage</span><span class="operators">,</span><span class="default">&nbsp;</span><span class="operators">...)</span>
<br /><span class="linenumbers">&nbsp;243&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="operators">{</span>
<br /><span class="linenumbers">&nbsp;244&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="default">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="identifiers">LPTSTR</span><span class="default">&nbsp;</span><span class="identifiers">pBuffer</span><span class="default">&nbsp;</span><span class="operators">=</span><span class="default">&nbsp;</span><span class="identifiers">NULL</span><span class="operators">;</span>
<br /><span class="linenumbers">&nbsp;245&nbsp;&nbsp;&nbsp;&nbsp;</span>
<br /><span class="linenumbers">&nbsp;246&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="default">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="identifiers">va_list</span><span class="default">&nbsp;</span><span class="identifiers">args</span><span class="default">&nbsp;</span><span class="operators">=</span><span class="default">&nbsp;</span><span class="identifiers">NULL</span><span class="operators">;</span>
<br /><span class="linenumbers">&nbsp;247&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="default">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="identifiers">va_start</span><span class="operators">(</span><span class="identifiers">args</span><span class="operators">,</span><span class="default">&nbsp;</span><span class="identifiers">pMessage</span><span class="operators">);</span>
<br /><span class="linenumbers">&nbsp;248&nbsp;&nbsp;&nbsp;&nbsp;</span>
<br /><span class="linenumbers">&nbsp;249&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="default">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="identifiers">FormatMessage</span><span class="operators">(</span><span class="identifiers">FORMAT_MESSAGE_FROM_STRING</span><span class="default">&nbsp;</span><span class="operators">|</span>
<br /><span class="linenumbers">&nbsp;250&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="default">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="identifiers">FORMAT_MESSAGE_ALLOCATE_BUFFER</span><span class="operators">,</span>
<br /><span class="linenumbers">&nbsp;251&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="default">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="identifiers">pMessage</span><span class="operators">,</span><span class="default">&nbsp;
</span><br /><span class="linenumbers">&nbsp;252&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="default">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="numbers">0</span><span class="operators">,</span>
<br /><span class="linenumbers">&nbsp;253&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="default">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="numbers">0</span><span class="operators">,</span>
<br /><span class="linenumbers">&nbsp;254&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="default">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="operators">(</span><span class="identifiers">LPWSTR</span><span class="operators">)&amp;</span><span class="identifiers">pBuffer</span><span class="operators">,</span><span class="default">&nbsp;
</span><br /><span class="linenumbers">&nbsp;255&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="default">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="numbers">0</span><span class="operators">,</span><span class="default">&nbsp;
</span><br /><span class="linenumbers">&nbsp;256&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="default">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="operators">&amp;</span><span class="identifiers">args</span><span class="operators">);</span>
<br /><span class="linenumbers">&nbsp;257&nbsp;&nbsp;&nbsp;&nbsp;</span>
<br /><span class="linenumbers">&nbsp;258&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="default">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="identifiers">va_end</span><span class="operators">(</span><span class="identifiers">args</span><span class="operators">);</span>
<br /><span class="linenumbers">&nbsp;259&nbsp;&nbsp;&nbsp;&nbsp;</span>
<br /><span class="linenumbers">&nbsp;260&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="default">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="keywords">return</span><span class="default">&nbsp;</span><span class="identifiers">pBuffer</span><span class="operators">;</span>
<br /><span class="linenumbers">&nbsp;261&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="operators">}</span></p></body></html>
